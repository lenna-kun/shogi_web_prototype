# 開発のワークフロー
## 環境準備
### Node package Managerのインストール
**Node Package Manager (npm)** はいろいろなパッケージ(React, FontAwsome, サーバー...)などを簡単に、かつ複数人で同じ環境で利用できるマネージャーです(要出典)。必要な外部パッケージはすべてnpmを通じてインストールするよう設計しています。  
npmはWindows, Mac, Linuxで利用できます。ますはnpmをインストールしてください。
### 依存パッケージのインストール
プロジェクトで利用し、インストールする必要のあるパッケージは `/package.json` に記載されています。必要なものは以下のコマンドでインストールできます。

    # 足りないパッケージをインストールする
    cd $(PROJECT_ROOT)
    npm install 

以上のコマンドを実行すると `/node_modules` というディレクトリが作られここにパッケージが保存されます。
### 新たなパッケージのインストール
もし新しく `new-package` というパッケージをインストールする場合は、以下のコマンドでインストールできます。

    # new-package というパッケージをローカルにインストール
    cd $(PROJECT_ROOT)
    npm install --save-dev new-package

ここで `--save-dev` オプション(`-D`と同義)はローカルに開発者モードとしてインストールするという意味です。複数人で開発する場合はこの設定がベストだと思うので、**リファレンス等で `-g` 等別のオプションが設定されていた場合は適宜 `--save-dev` オプションに変えてください**。  
新しいパッケージがインストールされたらその情報が `/package.json` に追加されます。他のユーザーは再び `npm install` コマンドで不足するパッケージをインストールできます。  
パッケージがぐちゃぐちゃになってよくわからなくなったときは、 `/node_modules` ディレクトリを削除して `npm install` コマンドを実行するとリセットできます。
### パッケージの実行  
例えばこのプロジェクトでは `serve` というパッケージを導入しています。これは簡易サーバーを起動することができるパッケージで、実行すると`http://localhost:5000`でアクセスできるようになります。  
ふつう、この serve というパッケージを実行する方法は以下のように書かれています。

    # ローカルインストールではパスが通ってないので実行できない
    serve

ただし本プロジェクトではこれでは実行できません。本プロジェクトはローカルにパッケージをインストールしているので、それを実行するには `npx` コマンドを利用してください。

    # パッケージの実行にはnpxコマンドを必ず利用する
    npx serve


## 開発手順
### 結論
一番上のディレクトリで以下を実行することで開発・プレビューができます。

    # 開発者モードでコンパイルしサーバーを起動する
    npm run start

    # 本番モードでコンパイルする
    npm run build

    # 開発者モードでコンパイルする
    npm run build-dev

    # サーバーを起動する
    npm run serve


### runコマンド
開発者モードでコンパイルするコマンドは以下です。

    npx webpack --config webpack.dev.config


これを毎回打つのは面倒なので、よく使うコマンドを登録しています。
登録しているコマンドは `/package.json` の `scripts` に書かれています。
例えば`/package.json`には

    “scripts”: {
        ...
    "build-dev": "npx webpack --config webpack.dev.config"
        ...
    }


と記載されています。この場合、先程のコマンドは

    npm run build-dev


で短縮実行することができます。
### コンパイル
本プロジェクトでは **webpack** を利用してコンパイルを行っています。コンパイルの詳細は**開発者用コンパイル**、**本番用コンパイル**がそれぞれ `webpack.dev.config` 、 `webpack.pro.config` に記載されています。簡単にまとめると、
- **babel**で`./src/index.js`から始めて`import`でインポートされているものを辿っていきながら一つのjsファイル、cssファイルにまとめる。同時にES5という普及しているJavaScriptの書き方に変換する。
- まとめてできたjsファイルを `./public/src/shogi-bundle.js` 、 cssファイルを `./public/src/shogi-bundle.css` に保存する
を行います。
### サーバー
`./public` をルートディレクトリとし、すべてのアクセスを `./public/index.html` に**rewrites** すると正しくパスが通るように設計しています。serveでのこの設定は `./serve.json` に記載されています。Apache等別の環境でも同様の設定は行うことができます。
